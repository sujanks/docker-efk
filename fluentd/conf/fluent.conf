<source>
  @type tail
  path /tmp/log/app.log
  pos_file /var/log/td-agent/httpd-access.log.pos
  tag log
  <parse>
    @type json
  </parse>
</source>

<filter **>
    @type record_transformer
    enable_ruby true
      <record>
        timestamp ${Time.now.strftime('%Y-%m-%dT%H:%M:%S.%L%z')}
      </record>
</filter>

<match **>
    @type copy
    <store>
        @type elasticsearch
        host elasticsearch
        port 9200
        logstash_format true
        logstash_prefix dev
        logstash_dateformat "%Y-%m-%d"
        utc_index false
        num_threads 2
        compression_level default_compression
        flush_interval 10s
        time_key_format "%Y-%m-%dT%H:%M:%S.%L%z"
        include_timestamp true
        time_key timestamp
     </store>
     <store>
       @type stdout

     </store>
</match>
